<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
  <t t-name="owl.OwlKesantrianDashboard" owl="1">
  <style>
  @media (max-width: 768px) {

    .controls-wrapper {
      flex-direction: column;
      width: 100%;
    }

    .dateButton {
      width: 100%;
    }

    .timerDropdown {
      display: flex;
      width: 100%;
      justify-content: between;
      margin-top: 0.5 rem;
    }
    .dropdownButton {
      width: 100%;
    }

    .timer-button {
      width: 30%;
    }
    .header-text {
      font-size: 1.2rem;
    }
  }

  .timerDropdown {
    display: flex;
    margin: 1rem;
  }
  </style>
    <div class="container-fluid vh-100">
      <!-- Header Full Width -->
      <div class="mx-2 my-1">
        <div class="col-12">
          <div class="p-2">
            <div
              class="d-flex flex-wrap align-items-center justify-content-between"
            >
            <div class="d-flex">
              <h2 class="text-primary fw-bold header-text">Dashboard Kesantrian</h2>
            </div>
              <div class="controls-wrapper d-flex align-items-center mt-1">
               <!-- Custom Date Range Button -->
                <button
                  class="btn btn-outline-secondary dateButton"
                  t-on-click="toggleDatePicker"
                >
                  <i class="fas fa-calendar"></i>
                  <t t-if="state.selectedDateRange">
                    <span
                      t-esc="formatDateRange(state.selectedDateRange.start, state.selectedDateRange.end)"
                      class="ms-2"
                    />
                  </t>
                  <t t-else=""> </t>
                </button>
                <div class="timerDropdown">
                <!-- Dropdown Periode -->
                <div class="dropdown me-3 dropdownButton"> 
                  <button
                    class="btn btn-outline-secondary dropdown-toggle dropdownButton"
                    type="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    <span t-esc="getPeriodLabel(state.selectedPeriod)" />
                  </button>
                  <ul class="dropdown-menu dropdownButton">
                    <li>
                      <a
                        class="dropdown-item d-flex justify-content-between align-items-center"
                        href="#"
                        id="selectionFilter"
                        t-on-click.prevent="() => this.setPeriod('bawaan')"
                      >
                        Default
                        <i
                          class="fas fa-check"
                          t-att-class="{'invisible': !isPeriodSelected('bawaan')}"
                        ></i>
                      </a>
                    </li>
                    <li>
                      <a
                        class="dropdown-item d-flex justify-content-between align-items-center"
                        href="#"
                        id="selectionFilter"
                        t-on-click.prevent="() => this.setPeriod('today')"
                      >
                        Hari Ini
                        <i
                          class="fas fa-check"
                          t-att-class="{'invisible': !isPeriodSelected('today')}"
                        ></i>
                      </a>
                    </li>
                    <li>
                      <a
                        class="dropdown-item d-flex justify-content-between align-items-center"
                        href="#"
                        id="selectionFilter"
                        t-on-click.prevent="() => this.setPeriod('yesterday')"
                      >
                        Kemarin
                        <i
                          class="fas fa-check"
                          t-att-class="{'invisible': !isPeriodSelected('yesterday')}"
                        ></i>
                      </a>
                    </li>
                    <li>
                      <a
                        class="dropdown-item d-flex justify-content-between align-items-center"
                        href="#"
                        id="selectionFilter"
                        t-on-click.prevent="() => this.setPeriod('thisWeek')"
                      >
                        Minggu Ini
                        <i
                          class="fas fa-check"
                          t-att-class="{'invisible': !isPeriodSelected('thisWeek')}"
                        ></i>
                      </a>
                    </li>
                    <li>
                      <a
                        class="dropdown-item d-flex justify-content-between align-items-center"
                        href="#"
                        id="selectionFilter"
                        t-on-click.prevent="() => this.setPeriod('lastWeek')"
                      >
                        Minggu Lalu
                        <i
                          class="fas fa-check"
                          t-att-class="{'invisible': !isPeriodSelected('lastWeek')}"
                        ></i>
                      </a>
                    </li>
                    <li>
                      <a
                        class="dropdown-item d-flex justify-content-between align-items-center"
                        href="#"
                        id="selectionFilter"
                        t-on-click.prevent="() => this.setPeriod('thisMonth')"
                      >
                        Bulan Ini
                        <i
                          class="fas fa-check"
                          t-att-class="{'invisible': !isPeriodSelected('thisMonth')}"
                        ></i>
                      </a>
                    </li>
                    <li>
                      <a
                        class="dropdown-item d-flex justify-content-between align-items-center"
                        href="#"
                        id="selectionFilter"
                        t-on-click.prevent="() => this.setPeriod('lastMonth')"
                      >
                        Bulan Lalu
                        <i
                          class="fas fa-check"
                          t-att-class="{'invisible': !isPeriodSelected('lastMonth')}"
                        ></i>
                      </a>
                    </li>
                    <li>
                      <a
                        class="dropdown-item d-flex justify-content-between align-items-center"
                        href="#"
                        id="selectionFilter"
                        t-on-click.prevent="() => this.setPeriod('thisYear')"
                      >
                        Tahun Ini
                        <i
                          class="fas fa-check"
                          t-att-class="{'invisible': !isPeriodSelected('thisYear')}"
                        ></i>
                      </a>
                    </li>
                    <li>
                      <a
                        class="dropdown-item d-flex justify-content-between align-items-center"
                        href="#"
                        id="selectionFilter"
                        t-on-click.prevent="() => this.setPeriod('lastYear')"
                      >
                        Tahun Lalu
                        <i
                          class="fas fa-check"
                          t-att-class="{'invisible': !isPeriodSelected('lastYear')}"
                        ></i>
                      </a>
                    </li>
                  </ul>
                </div>
                <!-- Timer Button -->
                <button id="timerButton" class="btn btn-outline-secondary timer-button">
                  <i id="timerIcon" class="fas fa-stopwatch"></i>
                  <span id="timerCountdown"></span>
                </button>
              </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Date Range Picker Popup -->
      <div
        t-if="state.showDatePicker"
        class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center"
        style="background: rgba(0, 0, 0, 0.5); z-index: 1050"
      >
        <div class="bg-white p-4 rounded shadow-lg">
          <div class="mb-3">
            <h5 class="mb-4">Pilih Rentang Tanggal</h5>
            <div class="mb-3">
              <label class="form-label">Dari</label>
              <input
                type="date"
                class="form-control"
                t-model="state.tempDateRange.start"
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Sampai</label>
              <input
                type="date"
                class="form-control"
                t-model="state.tempDateRange.end"
              />
            </div>
          </div>
          <div class="d-flex justify-content-end gap-2">
            <button class="btn btn-secondary" t-on-click="closeDatePicker">
              Batal
            </button>
            <button class="btn btn-primary" t-on-click="applyDateRange">
              Terapkan
            </button>
          </div>
        </div>
      </div>

      <!-- KPI Cards -->
      <div class="mx-0 my-0">
        <KpiCard />
      </div>

      <!-- Charts -->
      <div class="row mx-0 my-3">
        <div class="col-lg-6 col-md-12 col-sm-12 m-0 p-2">
          <div class="shadow-sm border p-4 bg-white h-100">
            <h2 class="mb-5">Absen Tahfizh per Kehadiran</h2>
            <ChartRenderer
              type="'donutChart'"
              period="state.selectedPeriod"
              startDate="state.selectedDateRange?.start"
              endDate="state.selectedDateRange?.end"
            />
          </div>
        </div>
        <div class="col-lg-6 col-md-12 col-sm-12 m-0 p-2">
          <div class="shadow-sm border p-4 bg-white h-100">
            <h2 class="mb-5">Absensi Tahsin per Kehadiran</h2>
            <ChartRenderer
              type="'donutChart2'"
              period="state.selectedPeriod"
              startDate="state.selectedDateRange?.start"
              endDate="state.selectedDateRange?.end"
            />
          </div>
        </div>
      </div>

      <div class="row mx-0 my-3">
        <div class="col-lg-6 col-md-12 col-sm-12 m-0 p-2">
          <div class="shadow-sm border p-4 bg-white h-100">
            <h2 class="mb-5">Absen Tahfizh per Halaqah</h2>
            <ChartRenderer
              type="'chart'"
              period="state.selectedPeriod"
              startDate="state.selectedDateRange?.start"
              endDate="state.selectedDateRange?.end"
            />
          </div>
        </div>
        <div class="col-lg-6 col-md-12 col-sm-12 m-0 p-2">
          <div class="shadow-sm border p-4 bg-white h-100">
            <h2 class="mb-5">Absensi Tahsin per Halaqah</h2>
            <ChartRenderer
              type="'chart2'"
              period="state.selectedPeriod"
              startDate="state.selectedDateRange?.start"
              endDate="state.selectedDateRange?.end"
            />
          </div>
        </div>
      </div>

      <div class="row mx-0 my-3">
        <!-- Pelanggaran Card -->
        <div class="col-lg-6 col-md-12 col-sm-12 m-0 p-2">
          <div
            class="shadow-sm bg-white h-100"
            style="border-radius: 0.375rem; overflow: hidden"
          >
            <PelanggaranCardList
              startDate="state.selectedDateRange?.start"
              endDate="state.selectedDateRange?.end"
            />
          </div>
        </div>

        <!-- Tahfidz Card -->
        <div class="col-lg-6 col-md-12 col-sm-12 m-0 p-2">
          <div
            class="shadow-sm bg-white h-100"
            style="border-radius: 0.375rem; overflow: hidden"
          >
            <TahfidzCardList
              startDate="state.selectedDateRange?.start"
              endDate="state.selectedDateRange?.end"
            />
          </div>
        </div>
      </div>
    </div>
  </t>
</templates>
